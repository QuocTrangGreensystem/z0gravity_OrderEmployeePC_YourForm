
tinymce.PluginManager.add('painter', function(editor, url) {

	function showPainter() {
		// // Insert caret marker
		// editor.focus();
		// editor.selection.collapse(true);
		// editor.selection.setContent('<span class="CmCaReT" style="display:none">&#0;</span>');
		var img = editor.selection.getNode(),
			img0 = img.querySelector('img');
		if( img.nodeName == 'IMG' || img0 ){
			if( img0 ){
				img = img0[0];
			}
			// // Open editor window
			var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
				h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
			var win = editor.windowManager.open({
				title: 'Painter',
				url: url + '/index.html',
				width: w - 20,
				height: h - 100,
				resizable : true,
				maximizable : true,
				buttons: [
					{ text: 'Ok', subtype: 'primary', onclick: function(){
						var doc = document.querySelectorAll('.mce-container-body>iframe')[0];
						doc.contentWindow.save();
						win.close();
					}},
					{ text: 'Cancel', onclick: 'close' }
				]
			});
		}
	};

	// Add a button to the button bar
	editor.addButton('painter', {
		title: 'Painter',
		icon: 'brush',
		onclick: showPainter
	});
});